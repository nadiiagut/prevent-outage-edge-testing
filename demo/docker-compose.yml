version: "3.8"

services:
  # NGINX edge proxy - the system under test
  edge:
    image: nginx:alpine
    ports:
      - "8080:80"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - upstream1
      - upstream2
    networks:
      - demo-net

  # Healthy upstream
  upstream1:
    image: nginx:alpine
    volumes:
      - ./upstream1.conf:/etc/nginx/nginx.conf:ro
    networks:
      - demo-net

  # Healthy upstream (for load balancing tests)
  upstream2:
    image: nginx:alpine
    volumes:
      - ./upstream2.conf:/etc/nginx/nginx.conf:ro
    networks:
      - demo-net

  # Faulty upstream (optional - for resilience tests)
  # Responds slowly or returns errors
  faulty:
    image: nginx:alpine
    volumes:
      - ./faulty.conf:/etc/nginx/nginx.conf:ro
    networks:
      - demo-net

networks:
  demo-net:
    driver: bridge
