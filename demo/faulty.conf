worker_processes 1;

events {
    worker_connections 256;
}

http {
    server {
        listen 80;
        server_name localhost;

        # Simulate slow responses (for timeout tests)
        location / {
            add_header X-Upstream-ID "faulty" always;
            # Lua would be needed for actual delay; this just returns error
            return 503 '{"server": "faulty", "status": "degraded", "error": "service_unavailable"}';
            add_header Content-Type application/json;
        }

        # Endpoint that always times out (returns after delay)
        location /slow {
            add_header X-Upstream-ID "faulty" always;
            return 504 '{"server": "faulty", "error": "timeout"}';
            add_header Content-Type application/json;
        }

        # Endpoint that returns 500 errors
        location /error {
            add_header X-Upstream-ID "faulty" always;
            return 500 '{"server": "faulty", "error": "internal_server_error"}';
            add_header Content-Type application/json;
        }

        location /health {
            return 503 'UNHEALTHY';
        }
    }
}
